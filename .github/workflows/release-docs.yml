name: docs

env:
  project: 'jdependency'

on:
  - push
  # release:
  #   types: [ published ]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:

    - name: Checkout
      uses: actions/checkout@v2

    - name: Setup
      uses: actions/setup-java@v1
      with:
        java-version: 14

    - name: Build
      run: mvn site

    - name: Publish
      env:
        VERSION: ${{ github.ref }}
        # echo "${GITHUB_REF/refs\/tags\/jdependency-v/}"
      run: |

        echo "tag_name=${{ github.event.release.tag_name }}"
        echo "github.ref=${{ github.ref }}"
        echo "VERSION=$VERSION"
        echo "TAG=${GITHUB_REF##*/}"

        mkdir -p site/release/VERSION
        mv target/site/xref site/release/VERSION/xref
        mv target/site/apidocs site/release/VERSION/apidocs
        echo "" > site/index.html
        find site

    # - name: Publish
    #   uses: peaceiris/actions-gh-pages@v3
    #   with:
    #     github_token: ${{ secrets.GITHUB_TOKEN }}
    #     publish_dir: ./target/site
    #     keep_files: true